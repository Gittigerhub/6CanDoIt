<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/superlayout}"
>
<head>
    <meta charset="UTF-8">
    <title>메뉴 목록</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
<div layout:fragment="content" class="container-fluid">
    <div class="row mt-5">
        <div class="col-2"></div>
        <div class="col-8">
            <!--검색 기능(keyword) 시작-->
            <form th:action="@{/menu/listmenu}" method="get">
                <div class="row p-5 bg-white"><!--틀-->
                    <div class="mb-3">
                        <h3>메뉴 검색</h3>
                    </div>
                    <div class="col-6">
                        <div class="input-group mb-3">
                            <select class="form-select" name="type"><!--type-->
                                <option th:selected="${type=='null'}"></option>
                                <option value="0" th:selected="${type=='1'}">메뉴명</option><!--검색 후 선택값으로 설정-->
                                <option value="1" th:selected="${type=='2'}">메뉴설명</option>
                                <option value="2" th:selected="${type=='3'}">메뉴명+설명</option>
                                <option value="3" th:selected="${type=='4'}">카테고리</option>
                                <option value="4" th:selected="${type=='0'}">전체</option>
                            </select>
                            <input type="text" class="form-control" name="keyword" th:value="${keyword}" placeholder="Search"><!--keyword-->
                            <button class="btn btn-success" type="submit">검색</button>
                        </div>
                    </div><!--검색-->
                    <div class="col-5"></div>
                    <div class="col-1">
                        <a th:href="@{/menu/registermenu}" class="btn btn-primary">등록</a>
                    </div><!--추가버튼-->
                </div>
            </form>
            <!--검색 기능(keyword) 끝-->
            <!-- 검색 결과 테이블 -->
            <table class="table table-bordered table-striped mt-4">
                <thead>
                <tr>
                    <th>카테고리</th>
                    <th>메뉴명</th>
                    <th>메뉴사진</th>
                    <th>메뉴설명</th>
                    <th>가격</th>
                    <th>등록일</th>
                </tr>
                </thead>
                <tbody>
                <!-- 메뉴 항목 반복 출력 -->
                <tr th:each="menu : ${menulist}">
                    <td th:text="${menu.menuCategory}"></td>
                    <td>
                        <!-- 메뉴명 클릭 시 상세보기로 이동하는 링크 추가 -->
                        <a th:href="@{/menu/readmenu(menuidx=${menu.idx})}" th:text="${menu.menuName}"></a>
                    </td>
                    <td>
                        <!-- 대표 이미지가 없을때 나오는 이미지 -->
                        <div style="flex-basis: 100%; text-align: left">
                            <th:block th:if="${!repImageMap[menu.idx]}">
                                <img style="width: 300px; height: 300px; object-fit: cover; margin: 10px" src="https://sixcandoitimage.s3.ap-northeast-2.amazonaws.com/images/noimage.jpg" alt="noimage">
                            </th:block>
                        </div>

                        <th:block th:each="data:${imageFileMap[menu.idx]}" th:if="${repImageMap[menu.idx]}">
                            <!-- 대표 이미지 -->
                            <th:block th:if="${data.repimageYn == 'Y'}">
                                <div style="flex-basis: 100%; text-align: left">
                                    <img style="width: 300px; height: 300px; object-fit: cover; margin: 10px" th:src="${data.url}" th:alt="${data.originName}">
                                </div>
                            </th:block>
                        </th:block>
                    </td>
                    <td th:text="${menu.menuContent}"></td>
                    <td th:text="${menu.menuPrice}"></td>
                    <td th:text="${menu.insDate}"></td>
                </tr>
                </tbody>
            </table>
            <!-- 페이징 처리 시작 -->
            <div class="d-flex justify-content-center" th:if="${menulist.isEmpty()}">조회된 내역이 없습니다.</div>
                <ul class="pagination">
                    <li class="page-item" th:if="${currentPage>1}">
                        <a class="page-link" th:href="@{/menu/listmenu(page=1, type=${type}, keyword=${keyword})}">≪</a>
                    </li>

                    <li class="page-item" th:if="${currentPage>1}">
                        <a class="page-link" th:href="@{/menu/listmenu(page=${prevPage}, type=${type}, keyword=${keyword})}">＜</a>
                    </li>

                    <li class="page-item" th:each="page:${#numbers.sequence(startPage, endPage, 1)}" th:class="${page == currentPage} ? 'active' : ''">
                        <a class="page-link" th:if="${page != currentPage}"
                           th:href="@{/menu/listmenu(page=${page}, type=${type}, keyword=${keyword})}" th:text="${page}"></a>
                        <!-- 현재 페이지일 때는 링크 없이 텍스트만 표시 -->
                        <span th:if="${page == currentPage}" class="page-link" th:text="${page}"></span>
                    </li>

                    <li class="page-item" th:if="${currentPage<endPage}">
                        <a class="page-link" th:href="@{/menu/listmenu(page=${nextPage}, type=${type}, keyword=${keyword})}">＞</a>
                    </li>

                    <li class="page-item" th:if="${currentPage<endPage}">
                        <a class="page-link" th:href="@{/menu/listmenu(page=${endPage}, type=${type}, keyword=${keyword})}">≫</a>
                    </li>
                </ul>
            </div>
            <!-- 페이징 처리 끝 -->
        </div>
        <div class="col-2"></div>
    </div>
</div>

</body>
</html>