<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/memberlayout}">
<head>
    <title>게시판</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
          rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle
    .min.js"></script>
    <!-- Add jQuery -->
    <!--<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>-->
    <style>
        .calendar {
            width: 100%;
            max-width: 700px;
            margin: 0 auto;
        }
        .calendar .calendar-day {
            height: 70px;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 1px solid #ddd;
            font-size: 1.2rem;
            cursor: pointer;
        }
        .calendar .calendar-header {
            background-color: #f8f9fa;
            font-weight: bold;
            border-bottom: 1px solid #ddd;
        }
        .calendar .calendar-day:hover {
            background-color: #e9ecef;
        }
        .calendar .today {
            background-color: #cce5ff;
        }
        .calendar .row {
            margin-bottom: 10px; /* 행 간격 추가 */
        }
        .calendar-day {
            width: 14.28%; /* 7일을 균등하게 분배 */
        }
    </style>
</head>
<body>
<div layout:fragment="content">
    <div class="container mt-5 p-5 bg-white">
        <div class="row">
            <div class="col-lg-2">
            </div>
            <div class="col-lg-8">
                <h2>객실 예약 조회</h2>
                <button type="button" class="btn btn-primary"
                        th:onclick="|location.href='@{/res/create}'|">등록</button>

                <!-- 검색 영역 -->
                <form th:action="@{/res/list}" method="get">
                    <div class="input-group mb-3 mt-3">
                        <input type="date" class="form-control" name="sdate"
                               th:value="${sdate}"> <!--예약시작일-->
                        <input type="date" class="form-control" name="edate"
                               th:value="${edate}"> <!--예약종료일-->

                        <button type="submit" class="btn btn-primary">검색</button>
                        <button type="reset" class="btn btn-secondary">지우기</button>
                    </div>
                </form>
                <!-- 검색 영역 끝 -->

                <!-- 달력 영역 -->
                <div class="container mt-5">
                    <h2 class="text-center">2024년 2월</h2>
                    <div class="calendar mt-4">
                        <div class="row text-center">
                            <div class="col">
                                <button class="btn btn-link" id="prevMonth">‹</button>
                            </div>
                            <div class="col">
                                <h4 id="monthYear">2024년 2월</h4>
                            </div>
                            <div class="col">
                                <button class="btn btn-link" id="nextMonth">›</button>
                            </div>
                        </div>
                        <!-- 요일 헤더 -->
                        <div class="row text-center calendar-header">
                            <div class="col">일</div>
                            <div class="col">월</div>
                            <div class="col">화</div>
                            <div class="col">수</div>
                            <div class="col">목</div>
                            <div class="col">금</div>
                            <div class="col">토</div>
                        </div>
                        <!-- 달력 날짜 -->
                        <div id="calendarBody" class="row"></div>
                    </div>
                </div>
                <!-- 달력 영역 끝 -->
            </div>
            <div class="col-lg-2"></div>
        </div>
    </div>
    <div class="container mt-5 p-5 bg-white">
        <div class="col-lg-2"></div>
        <div class="col-lg-8">
            <!-- 데이터 목록 -->
            <table class="table table-striped">
                <thead>
                <tr>
                    <th>번호</th>
                    <th>예약자</th>
                    <th>시작일</th>
                    <th>종료일</th>
                    <th>작업</th>
                    <th>예약 내역</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="data:${List}">
                    <td th:text="${data.idx}">1</td>
                    <!--                           th:text="${data.subject}">임시 제목</a></td>-->
                    <!--                    <td th:text="${#strings.length(data.content)>30?#strings.substring(
                                                data.content, 0, 30) + '...' : data.content}">내용</td>-->
                    <td th:text="${data.username}">예약자</td>
                    <td th:text="${#temporals.format(data.startDate,
                                'yyyy-MM-dd')}">2024-01-21</td>
                    <td th:text="${#temporals.format(data.endDate,
                                'yyyy-MM-dd')}">2024-01-21</td>
                    <td><a th:href="@{'/res/update/' + ${data.idx}}">수정</a>
                        <a th:href="@{'/res/delete/' + ${data.idx}}">취소</a></td>
                    <td>
                        <a th:href="@{detail(idx=${data.idx})}">조회하기</a>
                    </td>
                </tr>
                </tbody>
            </table>
            <!-- 데이터 목록 끝 -->
        </div>
        <div class="col-lg-2"></div>
    </div>
</div>

<!-- 파일 끝에 이 스크립트를 추가하세요 -->
<script th:inline="javascript">
    /* 성공 메시지가 있는지 확인하고 팝업으로 표시합니다. */
    var successMessage = /*[[${successMessage}]]*/ null;
    if (successMessage) {
        alert(successMessage);
    }

    // 현재 날짜를 기준으로 달력 출력하기
    const calendarBody = document.getElementById("calendarBody");
    const monthYear = document.getElementById("monthYear");
    const prevMonth = document.getElementById("prevMonth");
    const nextMonth = document.getElementById("nextMonth");

    let currentDate = new Date();

    // 달력 그리기 함수
    function renderCalendar(date) {
        const year = date.getFullYear();
        const month = date.getMonth();
        monthYear.innerHTML = `${year}년 ${month + 1}월`;

        // 첫 번째 날 구하기 (1일이 시작되는 요일)
        const firstDay = new Date(year, month, 1);
        const firstDayOfWeek = firstDay.getDay();

        // 마지막 날 구하기 (해당 월의 마지막 날짜)
        const lastDay = new Date(year, month + 1, 0);
        const lastDate = lastDay.getDate();

        // 달력 초기화
        calendarBody.innerHTML = "";

        let dayCounter = 1;

        // 첫 번째 주(공백 포함) 날짜 채우기
        let row = document.createElement("div");
        row.classList.add("row");
        for (let i = 0; i < firstDayOfWeek; i++) {
            const emptyCell = document.createElement("div");
            emptyCell.classList.add("col", "calendar-day");
            row.appendChild(emptyCell);
        }

        // 날짜 그리기
        for (let i = firstDayOfWeek; i < 7; i++) {
            const dayCell = document.createElement("div");
            dayCell.classList.add("col", "calendar-day");
            dayCell.innerHTML = dayCounter;
            if (dayCounter === currentDate.getDate() && currentDate.getMonth() === month) {
                dayCell.classList.add("today");
            }
            row.appendChild(dayCell);
            dayCounter++;
        }
        calendarBody.appendChild(row);

        // 나머지 주(다음 주부터 마지막 날까지) 그리기
        while (dayCounter <= lastDate) {
            row = document.createElement("div");
            row.classList.add("row");
            for (let i = 0; i < 7 && dayCounter <= lastDate; i++) {
                const dayCell = document.createElement("div");
                dayCell.classList.add("col", "calendar-day");
                dayCell.innerHTML = dayCounter;
                row.appendChild(dayCell);
                dayCounter++;
            }
            calendarBody.appendChild(row);
        }
    }

    // 이전 월로 이동
    prevMonth.addEventListener("click", () => {
        currentDate.setMonth(currentDate.getMonth() - 1);
        renderCalendar(currentDate);
    });

    // 다음 월로 이동
    nextMonth.addEventListener("click", () => {
        currentDate.setMonth(currentDate.getMonth() + 1);
        renderCalendar(currentDate);
    });

    // 페이지 로드 시 달력 출력
    renderCalendar(currentDate);
</script>
</body>
</html>